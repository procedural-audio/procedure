/**
    A simple synth using sine oscillators, showing use of the voice allocator,
    message converter and envelopes
*/

// Determine the note frequency from the pitch (midi note)
processor Sine [[ main, width: 80, height: 60 ]]
{
    input value float32 pitch [[ pinTop: 10 ]];
    output stream float32 out [[ pinTop: 10 ]];

    // Constants
    const float32 PI = 3.14159265358979323846f;
    const float32 TWO_PI = 2.0f * PI;
    const float32 SAMPLE_RATE = 44100.0f;

    // State variables
    float32 phase = 0.0;
    float32 frequency = 440.0;

    void main()
    {
        loop {
            // Convert MIDI pitch to frequency
            // frequency = 440.0f * pow(2.0f, (pitch - 69.0f) / 12.0f);
            frequency = 440.0f;

            // Generate sine wave
            float32 sample = sin(TWO_PI * phase);

            // Output the sample
            out <- sample;

            // Increment phase
            phase = phase + (frequency / SAMPLE_RATE);
            if (phase >= 1.0) {
                phase = phase - 1.0f;
            }

            advance();
        }
    }
}
